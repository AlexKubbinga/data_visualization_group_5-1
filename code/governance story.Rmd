---
title: "Governance Story"
author: "Alex Kubbinga"
date: "11/22/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```



```{r load-packages, echo=FALSE}
library(tidyverse)
library(extrafont)
library(mosaic)
library(vroom)
library(ggtext)
library(gapminder)
library(ggrepel)
library(patchwork)
library(gghighlight)
library(skimr)
library(sf)
library(lubridate)

loadfonts(device="pdf")
# loadfonts(device="pdf") if you have a mac
```

```{r esg}


esg_data_raw <- read_csv(here::here("data/ESG_csv","ESGData.csv"))

library(countrycode)
esg_data_final$continent = countrycode(sourcevar = esg_data_final$country_name,origin = "country.name",destination = "continent")

esg_data_final %>% filter(is.na(continent)) %>%  select(country_name) %>% unique()


glimpse(esg_data_raw)
skimr::skim(esg_data_raw)
ncol(esg_data_raw) #67 (col 66 is year 2050 and col 67 is a variable with no information names X67)
#cols 5-65 contain yearly data from 1960-2020
#most indicators have missing data for certainyears. 

#long data 
esg_data <- esg_data_raw %>% pivot_longer(cols=5:65, names_to = "Year") %>% select(-`2050`,-`X67`) %>% janitor::clean_names()


## ALL OF THIS IS NOT SUPER USEFUL FOR ANALYIS (but still look)
# Information on sources of different country series
# esg_countryseries <- read_csv(here::here("data/ESG_csv","ESGCountry-Series.csv"))

#Information on country statistics and methodology
# esg_country <- read_csv(here::here("data/ESG_csv","ESGCountry.csv"))

 #Shows sources of data
# esg_footnote <- read_csv(here::here("data/ESG_csv","ESGFootNote.csv"))

#Explain meaning of different features related to time series
# esg_series_time <- read_csv(here::here("data/ESG_csv","ESGSeries-Time.csv"))
# esg_series <- read_csv(here::here("data/ESG_csv","ESGSeries.csv"))

```   


```{r}



#here we create the wide useable data with each variable as its own column
esg_data_final <- esg_data  %>% select(-indicator_code) %>% group_by(indicator_name) %>% pivot_wider(names_from = indicator_name, values_from = value) %>% janitor::clean_names()

#Writes to data folder
write.csv(esg_data_final, here::here("data","esg_data_final.csv"))

skim(esg_data_final)

esg_data_final$year <- as.integer(esg_data_final$year)

esg_data_final %>% count(continent) %>% mutate(perc = round(100*n/sum(n),2))

esg_data_final %>% count(year) %>% mutate(perc = round(100*n/sum(n),2))
  
```

# Governance Story

Governance is how well a country/region can sustain its long term stability, growth and poverty reduction given its institutional capacity. It shows the strength of political, financial, legal systems and the capcity to address environmental & social risks. Governance is essentially an indicator of how well positioned a country is to improve (socially, environmentally and economically). How well is the country managed for growth.


```{r}
# install.packages("gganimate")
library(gganimate)
esg_data_final$individuals_using_the_internet_percent_of_population
esg_data_final$control_of_corruption_estimate

animation_selection <- esg_data_final %>% filter(country_name %in% c("China","United Kingdom","India","United States","South Africa"),
                          year >1999)

animation1 <- ggplot(data = animation_selection,
       mapping = aes(x = individuals_using_the_internet_percent_of_population,
                     y = control_of_corruption_estimate,
                     colour = continent,)) +
  geom_point(alpha = 0.5) +
  theme_bw() +
  theme(legend.position="none") +
  labs(title = "Year: {frame_time}", 
       x = "Internet Usage", 
       y = "Corruption Estimate") +    
  transition_time(year)+
  ease_aes("linear")

animate(animation1, height=600, width = 600)
```

```{r}
esg_data_final %>% 
  group_by(country_name) %>% 
  summarize( mean_)

#innovation

innovation <-esg_data_final %>% select(country_name, year, patent_applications_residents, research_and_development_expenditure_percent_of_gdp,scientific_and_technical_journal_articles, continent) %>% 
  group_by(continent) %>% 
  summarize(mean_patent = round(mean(patent_applications_residents, na.rm=TRUE),2),
            max_patent = max(patent_applications_residents, na.rm=TRUE),
            min_patent = min(patent_applications_residents, na.rm=TRUE))



corr(esg_data_final$individuals_using_the_internet_percent_of_population)

innovation %>% ggplot() +
  geom_col(aes(x=continent, y=mean_patent))
```

```{r}
library("GGally")

esg_data_final$voice_and_accountability_estimate
governance <- c(country_name, year, individuals_using_the_internet_percent_of_population,gdp_growth_annual_percent )

esg_data_final %>% 
  select(country_name, year,
         gdp_growth_annual_percent,ease_of_doing_business_rank_1_most_business_friendly_regulations,
         government_effectiveness_estimate, patent_applications_residents, political_stability_and_absence_of_violence_terrorism_estimate, school_enrollment_primary_percent_gross, strength_of_legal_rights_index_0_weak_to_12_strong, voice_and_accountability_estimate, individuals_using_the_internet_percent_of_population) %>% #keep Y variable last
  ggcorr(method = c("pairwise", "pearson"), layout.exp = 3,label_round=2, label = TRUE,label_size = 2,hjust = 1)


```

